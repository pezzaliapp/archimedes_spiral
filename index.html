<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>Archimedes Spiral — PWA Core (Qualità)</title>
  <meta name="theme-color" content="#0b1022">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root{--bg:#0b1022;--ink:#eaf1ff;--muted:#93a4cc}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 50% -20%,#172042,var(--bg));color:var(--ink);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial;display:flex;flex-direction:column}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #1c2550;background:#0e1533cc;backdrop-filter:blur(6px)}
    main{flex:1 1 auto;display:flex;flex-direction:column;gap:8px;padding:8px}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    .controls label{background:#0f1636;border:1px solid #1c2550;border-radius:10px;padding:6px 8px;color:var(--muted);display:flex;align-items:center;gap:6px}
    .controls button{background:transparent;color:var(--ink);border:1px solid #2a366d;border-radius:10px;padding:6px 10px;cursor:pointer}
    .stage{flex:1 1 auto;border:1px solid #1c2550;border-radius:14px;overflow:hidden;background:#0b1130;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    canvas{display:block;width:100%;height:100%}
    footer{padding:8px;text-align:center;color:var(--muted);border-top:1px solid #1c2550}
  </style>
</head>
<body>

  <header>
    <strong>Archimedes Spiral — PWA Core (Qualità)</strong>
    <span style="opacity:.7">PWA pronta (usa app.js)</span>
  </header>

  <main>
    <!-- Barra controlli principale -->
    <div class="controls">
      <label>Modo
        <select id="mode">
          <option value="2d" selected>2D</option>
          <option value="3d">3D (elica)</option>
        </select>
      </label>

      <label>Giri
        <input id="turns" type="number" min="1" max="50" step="1" value="12" style="width:72px">
      </label>

      <label>Passo b
        <input id="b" type="number" min="1" max="30" step="0.5" value="6" style="width:72px">
      </label>

      <label>Spessore
        <input id="lw" type="number" min="1" max="5" step="1" value="2" style="width:64px">
      </label>

      <label>Colore
        <input id="color" type="color" value="#2dd4bf">
      </label>

      <label>Gradiente
        <select id="gradientMode">
          <option value="none" selected>Nessuno</option>
          <option value="depth">Profondità</option>
          <option value="radius">Distanza</option>
          <option value="angle">Angolo</option>
        </select>
      </label>

      <label><input id="points" type="checkbox"> Punti</label>
      <label><input id="animate" type="checkbox" checked> Anima</label>

      <label class="only3d" style="display:none">z/giro
        <input id="zpt" type="number" min="-400" max="400" step="1" value="140" style="width:72px">
      </label>

      <label class="only3d" style="display:none">FOV
        <input id="fov" type="number" min="200" max="1400" step="10" value="700" style="width:72px">
      </label>

      <label class="only3d" style="display:none">Rot Y (°/s)
        <input id="ry" type="number" min="-180" max="180" step="1" value="20" style="width:72px">
      </label>

      <label>Qualità
        <select id="quality">
          <option value="low">Bassa</option>
          <option value="med" selected>Media</option>
          <option value="high">Alta</option>
        </select>
      </label>

      <button id="btnAutoQuality">Qualità Auto</button>
    </div>

    <!-- Sezione Registrazione -->
    <div class="controls" style="gap:8px;margin-top:6px;border-top:1px dashed #2a366d;padding-top:8px">
      <strong style="opacity:.8">Registrazione</strong>
      <label>Durata (s)
        <input id="recSecs" type="number" min="1" max="30" step="1" value="5" style="width:64px">
      </label>
      <button id="btnRecWebM">Rec WebM</button>
      <button id="btnStopRec" disabled>Stop</button>
      <button id="btnFrames">Frames PNG</button>
    </div>

    <div class="stage"><canvas id="cv"></canvas></div>
  </main>

  <footer>© 2025 — PWA definitiva · vREC3 (app.js)</footer>

  <!-- usa SOLO lo script esterno; niente duplicati inline -->
  <script src="app.js"></script>

  <!-- (opzionale) Registra il Service Worker se hai sw.js nella stessa cartella
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
  -->
</body>
</html>
